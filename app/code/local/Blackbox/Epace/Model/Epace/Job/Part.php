<?php

/**
 * @method bool getAllowancesChanged()
 * @method float getTabSpine()
 * @method float getTabFace()
 * @method float getTabHead()
 * @method float getTabFoot()
 * @method float getBleedsSpine()
 * @method float getBleedsFace()
 * @method float getBleedsHead()
 * @method float getBleedsFoot()
 * @method float getTrimSpine()
 * @method float getTrimFace()
 * @method float getTrimHead()
 * @method float getTrimFoot()
 * @method float getOddPanelSpineSize()
 * @method int getNumOddPanelsSpine()
 * @method float getOddPanelWidthSize()
 * @method int getNumOddPanelsWidth()
 * @method float getSpineSize()
 * @method bool getMetrixEnabled()
 * @method string getActualShipDate()
 * @method float getBilledAmt()
 * @method int getBillRate()
 * @method string getBillUOM()
 * @method int getBinderyMethod()
 * @method string getBinderyWork()
 * @method int getBleedsAcross()
 * @method int getBleedsAlong()
 * @method int getColorsS1()
 * @method int getColorsS2()
 * @method int getColorsTotal()
 * @method float getCoTotal()
 * @method string getDateSetup()
 * @method string getDescription()
 * @method string getDesktop()
 * @method float getEstCostPerM()
 * @method float getEstimatedCost()
 * @method int getEstimator()
 * @method float getFlatSizeH()
 * @method float getFlatSizeW()
 * @method float getFinalSizeH()
 * @method float getFinalSizeW()
 * @method float getTrimSizeHeight()
 * @method float getTrimSizeWidth()
 * @method int getFolderNumUp()
 * @method int getFoldPattern()
 * @method string getFoldPatternDesc()
 * @method int getGrainSpecifications()
 * @method string getInkDescS1()
 * @method string getInkDescS2()
 * @method string getInvoiceDate()
 * @method int getInvoiceSequence()
 * @method float getJobCost01()
 * @method string getJobPart()
 * @method int getJobType()
 * @method int getLastActCode()
 * @method string getLastActDate()
 * @method string getLastActTime()
 * @method string getLastCODate()
 * @method int getLastCODept()
 * @method string getLastCOTime()
 * @method string getMaterialProvided()
 * @method int getNumPrsShtsOut()
 * @method int getNumSigs()
 * @method bool getLoadBalanced()
 * @method int getPages()
 * @method int getParallelFolds()
 * @method string getPrep()
 * @method bool getSeparateLayout()
 * @method int getPress1()
 * @method int getPressSheetNumOut()
 * @method string getJobProductType()
 * @method string getProductionStatus()
 * @method int getQtyOrdered()
 * @method int getQtyShipped()
 * @method int getQtyToMfg()
 * @method float getQuotedPrice()
 * @method bool getQuotedPriceForced()
 * @method float getQuotePerM()
 * @method int getRightFolds()
 * @method int getRunMethod()
 * @method int getSalesCategory()
 * @method int getSheetsNetRequired()
 * @method int getSheetsOffPress()
 * @method float getSheetsToPress()
 * @method int getStitcherNumUp()
 * @method string getTimeSetUp()
 * @method float getTotalHours()
 * @method bool getUseBasicJacket()
 * @method int getNumPressForms()
 * @method int getNumSigsOddPressForm()
 * @method int getNumPlies()
 * @method bool getCalculating()
 * @method int getManufacturingLocation()
 * @method int getOriginalManufacturingLocation()
 * @method float getNonImageHead()
 * @method float getNonImageFoot()
 * @method float getNonImageSpine()
 * @method float getNonImageFace()
 * @method int getRun()
 * @method string getPaceConnectFileType()
 * @method int getShippingWorkflow()
 * @method int getPrepressWorkflow()
 * @method bool getUseLegacyPrintFlowFormat()
 * @method int getShipToJobContact()
 * @method bool getDirectMailPart()
 * @method string getBindingSide()
 * @method string getJogSide()
 * @method bool getJdfSubmitted()
 * @method string getLastStatusChangedDate()
 * @method string getLastStatusChangedTime()
 * @method bool getProofRequired()
 * @method bool getProofPart()
 * @method int getResolution()
 * @method bool getTileProduct()
 * @method string getSeamDirection()
 * @method bool getUsePressForms()
 * @method bool getGangable()
 * @method int getJobProduct()
 * @method bool getFinishedAutoImport()
 * @method float getValue()
 * @method int getProductionType()
 * @method string getQueueDestination()
 * @method bool getRequiresImposition()
 * @method string getComponentDescription()
 * @method int getEstimateVersion()
 * @method bool getInvoiceW2POrderAmount()
 * @method bool getInvoiceW2PShippingAmount()
 * @method bool getInvoiceW2PTaxAmount()
 * @method bool getInvoiceW2PHandlingAmount()
 * @method int getPrintRunMethod()
 * @method bool getMxmlLayoutInvalid()
 * @method float getOriginalQuotedPrice()
 * @method bool getOriginalQuotedPriceForced()
 * @method float getOriginalQuotedPricePerM()
 * @method bool getOriginalQuotedPricePerMForced()
 * @method float getTransactionHours()
 * @method int getTransactionCosts()
 * @method string getColors()
 * @method float getTotalCost()
 * @method float getTargetSellPrice()
 * @method float getQuantityRemaining()
 * @method bool getScheduled()
 * @method bool getIncludeMailing()
 * @method float getCalculatedTabSpine()
 * @method float getCalculatedTabFace()
 * @method float getCalculatedTabHead()
 * @method float getCalculatedTabFoot()
 * @method float getCalculatedBleedsSpine()
 * @method float getCalculatedBleedsFace()
 * @method float getCalculatedBleedsHead()
 * @method float getCalculatedBleedsFoot()
 * @method float getCalculatedTrimSpine()
 * @method float getCalculatedTrimFace()
 * @method float getCalculatedTrimHead()
 * @method float getCalculatedTrimFoot()
 * @method float getCalculatedOddPanelSpineSize()
 * @method int getCalculatedNumOddPanelsSpine()
 * @method float getCalculatedOddPanelWidthSize()
 * @method int getCalculatedNumOddPanelsWidth()
 * @method float getCalculatedSpineSize()
 * @method string getPrimaryKey()
 * @method string getFoldPatternKey()
 *
 * Class Blackbox_Epace_Model_Epace_Job_Part
 */
class Blackbox_Epace_Model_Epace_Job_Part extends Blackbox_Epace_Model_Epace_Job_AbstractChild
{
    /**
     * @var Blackbox_Epace_Model_Epace_Job_Product
     */
    protected $product = null;

    /**
     * @var Blackbox_Epace_Model_Epace_Estimate
     */
    protected $estimate = null;

    /**
     * @var Blackbox_Epace_Model_Epace_Estimate_Part
     */
    protected $estimatePart = null;

    protected function _construct()
    {
        $this->_init('JobPart', 'primaryKey');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Product
     */
    public function getProduct()
    {
        return $this->_getObject('product', 'jobProduct', 'efi/job_product');
    }

    public function setProduct(Blackbox_Epace_Model_Epace_Job_Product $product)
    {
        $this->product = $product;

        return $this;
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Estimate|bool
     */
    public function getEstimate()
    {
        if (is_null($this->estimate)) {
            $this->estimate = false;
            if ($this->getData('estimate')) {
                /** @var Blackbox_Epace_Model_Resource_Epace_Estimate_Collection $collection */
                $collection = $this->_getCollection('efi/estimate_collection');
                $collection->addFilter('estimateNumber', $this->getData('estimate'));
                $collection->setPageSize(1)->setCurPage(1);
                $estimate = $collection->getFirstItem();
                if ($estimate && $estimate->getId()) {
                    $this->estimate = $estimate;
                }
            }
        }
        return $this->estimate;
    }

    /**
     * @param Blackbox_Epace_Model_Epace_Estimate $estimate
     * @return $this
     */
    public function setEstimate(Blackbox_Epace_Model_Epace_Estimate $estimate)
    {
        $this->estimate = $estimate;

        return $this;
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Estimate_Part|false
     */
    public function getEstimatePart()
    {
        if (is_null($this->estimatePart)) {
            $this->estimatePart = false;

            if (!empty($this->getData('estimatePart')) && $this->getJob()->getEstimate()) {
                $targetNum = (int)$this->getData('estimatePart');
                $i = 0;
                $part = null;
                foreach ($this->getJob()->getEstimate()->getParts() as $_part) {
                    if (++$i == $targetNum) {
                        $part = $_part;
                        break;
                    }
                }
                if ($part) {
                    $this->estimatePart = $part;
                }
            }
        }

        return $this->estimatePart;
    }

    /**
     * @param Blackbox_Epace_Model_Epace_Estimate_Part $estimatePart
     * @return $this
     */
    public function setEstimatePart(Blackbox_Epace_Model_Epace_Estimate_Part $estimatePart)
    {
        $this->estimatePart = $estimatePart;

        return $this;
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Material[]
     */
    public function getMaterials()
    {
        return $this->_getPartItems('efi/job_material_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_PrePressOp[]
     */
    public function getPrePressOps()
    {
        return $this->_getPartItems('efi/job_part_prePressOp_collection');
    }

    /**
     * @return Blackbox_Epace_model_Epace_Change_Order[]
     */
    public function getChangeOrders()
    {
        return $this->_getPartItems('efi/change_order_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Proof[]
     */
    public function getProofs()
    {
        return $this->_getPartItems('efi/proof_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_Item[]
     */
    public function getItems()
    {
        return $this->_getPartItems('efi/job_part_item_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_PressForm[]
     */
    public function getPressForms()
    {
        return $this->_getPartItems('efi/job_part_pressForm_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Component[]
     */
    public function getComponents()
    {
        return $this->_getPartItems('efi/job_component_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_FinishingOp[]
     */
    public function getFinishingOps()
    {
        return $this->_getPartItems('efi/job_part_finishingOp_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_OutsidePurch[]
     */
    public function getOutsidePurchs()
    {
        return $this->_getPartItems('efi/job_part_outsidePurch_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Plan[]
     */
    public function getPlans()
    {
        return $this->_getPartItems('efi/job_plan_collection', [
            'job' => $this->getData('job'),
            'part' => $this->getData('jobPart')
        ]);
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Material[]
     */
    public function getCosts()
    {
        return $this->_getPartItems('efi/job_material_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Job_Part_SizeAllowance[]
     */
    public function getSizeAllowances()
    {
        return $this->_getPartItems('efi/job_part_sizeAllowance_collection');
    }

    /**
     * @return Blackbox_Epace_Model_Epace_Invoice[]
     */
    public function getInvoices()
    {
        return $this->_getPartItems('efi/invoice_collection');
    }

    public function getDefinition()
    {
        return [
            'visualOpeningSizeHeight' => '',
            'visualOpeningSizeWidth' => '',
            'allowancesChanged' => 'bool',
            'metrixEnabled' => 'bool',
            'gripperColorBar' => '',
            'metrixID' => '',
            'metrixComponentID' => '',
            'billRate' => '',
            'billUOM' => '',
            'binderyMethod' => '',
            'binderyWork' => '',
            'bleedsAcross' => '',
            'bleedsAlong' => '',
            'colorsS1' => '',
            'colorsS2' => '',
            'colorsTotal' => '',
            'dateSetup' => '',
            'description' => '',
            'desktop' => '',
            'estCostPerM' => '',
            'estimate' => '',
            'estimatePart' => '',
            'estimatedCost' => '',
            'estimator' => '',
            'flatSizeH' => '',
            'flatSizeW' => '',
            'finalSizeH' => '',
            'finalSizeW' => '',
            'trimSizeHeight' => '',
            'trimSizeWidth' => '',
            'folderNumUp' => '',
            'foldPattern' => '',
            'foldPatternDesc' => '',
            'grainSpecifications' => '',
            'inkDescS1' => '',
            'invoiceSequence' => '',
            'job' => '',
            'jobCost01' => '',
            'jobPart' => '',
            'jobType' => '',
            'lastActCode' => '',
            'lastActDate' => '',
            'lastActTime' => '',
            'materialProvided' => '',
            'numPrsShtsOut' => '',
            'numSigs' => '',
            'loadBalanced' => 'bool',
            'pages' => '',
            'parallelFolds' => '',
            'plates' => '',
            'prep' => '',
            'separateLayout' => 'bool',
            'press1' => '',
            'pressSheetNumOut' => '',
            'jobProductType' => '',
            'priority' => '',
            'productionStatus' => '',
            'proofs' => '',
            'qtyOrdered' => '',
            'qtyToMfg' => '',
            'quotedPrice' => '',
            'quotedPriceForced' => 'bool',
            'quotePerM' => '',
            'rightFolds' => '',
            'runMethod' => '',
            'salesCategory' => '',
            'sheetsNetRequired' => '',
            'sheetsOffPress' => '',
            'sheetsToPress' => '',
            'stitcherNumUp' => '',
            'timeSetUp' => '',
            'totalHours' => '',
            'useBasicJacket' => 'bool',
            'numPressForms' => '',
            'numSigsOddPressForm' => '',
            'numPlies' => '',
            'calculating' => 'bool',
            'manufacturingLocation' => '',
            'originalManufacturingLocation' => '',
            'jogTrim' => '',
            'nonImageHead' => '',
            'nonImageFoot' => '',
            'nonImageSpine' => '',
            'nonImageFace' => '',
            'run' => '',
            'paceConnectFileType' => '',
            'shippingWorkflow' => '',
            'prepressWorkflow' => '',
            'useLegacyPrintFlowFormat' => 'bool',
            'directMailPart' => 'bool',
            'bindingSide' => '',
            'jogSide' => '',
            'jdfSubmitted' => 'bool',
            'lastStatusChangedDate' => '',
            'lastStatusChangedTime' => '',
            'proofRequired' => 'bool',
            'proofPart' => 'bool',
            'resolution' => '',
            'tileProduct' => 'bool',
            'seamDirection' => '',
            'usePressForms' => 'bool',
            'gangable' => 'bool',
            'jobProduct' => '',
            'finishedAutoImport' => 'bool',
            'value' => '',
            'productionType' => '',
            'queueDestination' => '',
            'requiresImposition' => 'bool',
            'componentDescription' => '',
            'estimateVersion' => '',
            'invoiceW2POrderAmount' => 'bool',
            'invoiceW2PShippingAmount' => 'bool',
            'invoiceW2PTaxAmount' => 'bool',
            'invoiceW2PHandlingAmount' => 'bool',
            'printRunMethod' => '',
            'mxmlLayoutInvalid' => 'bool',
            'originalQuotedPrice' => '',
            'originalQuotedPriceForced' => 'bool',
            'originalQuotedPricePerM' => '',
            'originalQuotedPricePerMForced' => 'bool',
            'transactionHours' => '',
            'transactionCosts' => '',
            'colors' => '',
            'totalCost' => '',
            'targetSellPrice' => '',
            'quantityRemaining' => '',
            'scheduled' => 'bool',
            'includeMailing' => 'bool',
            'calculatedTabSpine' => '',
            'calculatedTabFace' => '',
            'calculatedTabHead' => '',
            'calculatedTabFoot' => '',
            'calculatedBleedsSpine' => '',
            'calculatedBleedsFace' => '',
            'calculatedBleedsHead' => '',
            'calculatedBleedsFoot' => '',
            'calculatedTrimSpine' => '',
            'calculatedTrimFace' => '',
            'calculatedTrimHead' => '',
            'calculatedTrimFoot' => '',
            'calculatedOddPanelSpineSize' => '',
            'calculatedNumOddPanelsSpine' => '',
            'calculatedOddPanelWidthSize' => '',
            'calculatedNumOddPanelsWidth' => '',
            'calculatedSpineSize' => '',
            'primaryKey' => '',
            'foldPatternKey' => '',
        ];
    }

    /**
     * @param $collectionName
     * @return Blackbox_Epace_Model_Epace_Job_Part_AbstractChild[]
     */
    protected function _getPartItems($collectionName, $filters = null)
    {
        if (!$filters) {
            $filters = [
                'job' => $this->getData('job'),
                'jobPart' => $this->getData('jobPart')
            ];
        }
        $job = $this->getJob();
        return $this->_getChildItems($collectionName, $filters, function ($item) use ($job) {
            if ($job) {
                $item->setJob($job);
            }
            $item->setPart($this);
        });
    }
}